<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Üslü Sayı Macerası</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(to bottom, #87CEEB, #1E90FF);
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #game-container {
            position: relative;
            width: 800px;
            height: 500px;
            border: 4px solid #333;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        #game-canvas {
            background: linear-gradient(to bottom, #87CEEB, #1E90FF);
            display: block;
        }
        
        #ui-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 18px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }
        
        #score, #lives, #level, #questions-count {
            margin-bottom: 5px;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 10px;
            display: inline-block;
            margin-right: 10px;
        }
        
        #question-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            text-align: center;
            z-index: 20;
            display: none;
            width: 400px;
        }
        
        #question-text {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }
        
        .answer-option {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .answer-option:hover {
            background: #45a049;
        }
        
        #game-over, #level-complete {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            z-index: 30;
            display: none;
        }
        
        #restart-btn, #next-level-btn {
            padding: 12px 24px;
            margin-top: 20px;
            background: #FF9800;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        #restart-btn:hover, #next-level-btn:hover {
            background: #F57C00;
        }
        
        #instructions {
            position: absolute;
            bottom: 10px;
            left: 10px;
            color: white;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px;
            border-radius: 8px;
        }
        
        .question-block {
            width: 40px;
            height: 40px;
            background: #FFD700;
            border: 2px solid #CC9900;
            border-radius: 5px;
            position: absolute;
            animation: bounce 1s infinite alternate;
        }
        
        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-5px); }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas" width="800" height="500"></canvas>
        
        <div id="ui-overlay">
            <div id="score">Puan: 0</div>
            <div id="lives">Can: 3</div>
            <div id="level">Seviye: 1</div>
            <div id="questions-count">Sorular: 0/3</div>
        </div>
        
        <div id="question-popup">
            <div id="question-text">2³ kaçtır?</div>
            <button class="answer-option" data-value="6">6</button>
            <button class="answer-option" data-value="8">8</button>
            <button class="answer-option" data-value="10">10</button>
            <button class="answer-option" data-value="12">12</button>
        </div>
        
        <div id="game-over">
            <h2>Oyun Bitti!</h2>
            <p>Toplam Puan: <span id="final-score">0</span></p>
            <button id="restart-btn">Yeniden Başla</button>
        </div>
        
        <div id="level-complete">
            <h2>Tebrikler!</h2>
            <p>Seviyeyi Tamamladın!</p>
            <p>Kazandığın Puan: <span id="level-score">0</span></p>
            <p>Doğru Çözülen Sorular: <span id="correct-questions">0</span>/3</p>
            <button id="next-level-btn">Sonraki Seviye</button>
        </div>
        
        <div id="instructions">
            Yön Tuşları: Hareket | Boşluk: Zıpla | Soru Bloklarına Zıplayarak Soruları Aç
        </div>
    </div>

    <script>
        // Oyun değişkenleri
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const questionPopup = document.getElementById('question-popup');
        const questionText = document.getElementById('question-text');
        const answerOptions = document.querySelectorAll('.answer-option');
        const gameOverScreen = document.getElementById('game-over');
        const levelCompleteScreen = document.getElementById('level-complete');
        const restartBtn = document.getElementById('restart-btn');
        const nextLevelBtn = document.getElementById('next-level-btn');
        const scoreElement = document.getElementById('score');
        const livesElement = document.getElementById('lives');
        const levelElement = document.getElementById('level');
        const questionsCountElement = document.getElementById('questions-count');
        const finalScoreElement = document.getElementById('final-score');
        const levelScoreElement = document.getElementById('level-score');
        const correctQuestionsElement = document.getElementById('correct-questions');
        
        // Oyun durumu
        let gameState = {
            score: 0,
            lives: 3,
            level: 1,
            isGameOver: false,
            isLevelComplete: false,
            currentQuestion: null,
            questionsAnswered: 0,
            questionsCorrect: 0,
            player: {
                x: 50,
                y: 350,
                width: 30,
                height: 50,
                velocityX: 0,
                velocityY: 0,
                isJumping: false,
                speed: 5,
                jumpPower: 12,
                gravity: 0.5
            },
            platforms: [],
            coins: [],
            enemies: [],
            questionBlocks: [],
            keys: {
                left: false,
                right: false,
                up: false
            },
            camera: {
                x: 0,
                y: 0
            }
        };
        
        // Üslü sayı soruları
        const questions = [
            { base: 1, exponent: 2, answer: 1, wrongAnswers: [2, 3, 4] },
            { base: 1, exponent: 5, answer: 1, wrongAnswers: [5, 10, 15] },
            { base: 2, exponent: 2, answer: 4, wrongAnswers: [3, 5, 6] },
            { base: 2, exponent: 3, answer: 8, wrongAnswers: [6, 9, 10] },
            { base: 2, exponent: 4, answer: 16, wrongAnswers: [8, 12, 20] },
            { base: 3, exponent: 2, answer: 9, wrongAnswers: [6, 8, 12] },
            { base: 3, exponent: 3, answer: 27, wrongAnswers: [9, 18, 24] },
            { base: 4, exponent: 2, answer: 16, wrongAnswers: [8, 12, 20] },
            { base: 4, exponent: 3, answer: 64, wrongAnswers: [16, 32, 48] },
            { base: 5, exponent: 2, answer: 25, wrongAnswers: [10, 20, 30] },
            { base: 5, exponent: 3, answer: 125, wrongAnswers: [25, 75, 100] },
            { base: 6, exponent: 2, answer: 36, wrongAnswers: [12, 24, 30] },
            { base: 6, exponent: 3, answer: 216, wrongAnswers: [36, 108, 180] },
            { base: 10, exponent: 2, answer: 100, wrongAnswers: [20, 50, 200] },
            { base: 10, exponent: 3, answer: 1000, wrongAnswers: [100, 500, 2000] },
            { base: 10, exponent: 4, answer: 10000, wrongAnswers: [1000, 5000, 20000] }
        ];
        
        // Oyunu başlat
        function initGame() {
            // Platformları oluştur
            createLevel();
            
            // Olay dinleyicileri
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
            restartBtn.addEventListener('click', restartGame);
            nextLevelBtn.addEventListener('click', nextLevel);
            
            // Soru butonlarına tıklama olayı ekle
            answerOptions.forEach(option => {
                option.addEventListener('click', () => checkAnswer(parseInt(option.getAttribute('data-value'))));
            });
            
            // Oyun döngüsünü başlat
            gameLoop();
        }
        
        // Seviye oluştur
        function createLevel() {
            gameState.platforms = [];
            gameState.coins = [];
            gameState.enemies = [];
            gameState.questionBlocks = [];
            gameState.questionsAnswered = 0;
            gameState.questionsCorrect = 0;
            
            // Zemin
            gameState.platforms.push({ x: 0, y: 450, width: 2000, height: 50 });
            
            // Platformlar
            gameState.platforms.push({ x: 200, y: 350, width: 100, height: 20 });
            gameState.platforms.push({ x: 400, y: 300, width: 100, height: 20 });
            gameState.platforms.push({ x: 600, y: 250, width: 100, height: 20 });
            gameState.platforms.push({ x: 800, y: 200, width: 100, height: 20 });
            gameState.platforms.push({ x: 1000, y: 150, width: 100, height: 20 });
            gameState.platforms.push({ x: 1200, y: 200, width: 100, height: 20 });
            gameState.platforms.push({ x: 1400, y: 250, width: 100, height: 20 });
            gameState.platforms.push({ x: 1600, y: 300, width: 100, height: 20 });
            gameState.platforms.push({ x: 1800, y: 350, width: 100, height: 20 });
            
            // Soru blokları (en az 3 tane)
            gameState.questionBlocks.push({ x: 250, y: 310, width: 40, height: 40, used: false });
            gameState.questionBlocks.push({ x: 650, y: 210, width: 40, height: 40, used: false });
            gameState.questionBlocks.push({ x: 1050, y: 110, width: 40, height: 40, used: false });
            
            // Coin'ler
            for (let i = 0; i < 15; i++) {
                gameState.coins.push({
                    x: 150 + i * 120,
                    y: 300 - Math.sin(i) * 50,
                    width: 20,
                    height: 20,
                    collected: false
                });
            }
            
            // Düşmanlar
            for (let i = 0; i < 5; i++) {
                gameState.enemies.push({
                    x: 300 + i * 300,
                    y: 430,
                    width: 30,
                    height: 20,
                    speed: 2,
                    direction: 1
                });
            }
            
            // Oyuncuyu başlangıç konumuna yerleştir
            gameState.player.x = 50;
            gameState.player.y = 350;
            gameState.player.velocityX = 0;
            gameState.player.velocityY = 0;
            
            // Kamerayı sıfırla
            gameState.camera.x = 0;
            gameState.camera.y = 0;
            
            // UI'ı güncelle
            updateUI();
        }
        
        // Tuş basma olayı
        function handleKeyDown(e) {
            if (e.key === 'ArrowLeft') gameState.keys.left = true;
            if (e.key === 'ArrowRight') gameState.keys.right = true;
            if (e.key === 'ArrowUp' || e.key === ' ') gameState.keys.up = true;
        }
        
        // Tuş bırakma olayı
        function handleKeyUp(e) {
            if (e.key === 'ArrowLeft') gameState.keys.left = false;
            if (e.key === 'ArrowRight') gameState.keys.right = false;
            if (e.key === 'ArrowUp' || e.key === ' ') gameState.keys.up = false;
        }
        
        // Oyuncuyu güncelle
        function updatePlayer() {
            // Yatay hareket
            if (gameState.keys.left) {
                gameState.player.velocityX = -gameState.player.speed;
            } else if (gameState.keys.right) {
                gameState.player.velocityX = gameState.player.speed;
            } else {
                gameState.player.velocityX = 0;
            }
            
            // Zıplama
            if (gameState.keys.up && !gameState.player.isJumping) {
                gameState.player.velocityY = -gameState.player.jumpPower;
                gameState.player.isJumping = true;
            }
            
            // Yerçekimi
            gameState.player.velocityY += gameState.player.gravity;
            
            // Yeni pozisyon
            gameState.player.x += gameState.player.velocityX;
            gameState.player.y += gameState.player.velocityY;
            
            // Platform çarpışması
            let onGround = false;
            for (const platform of gameState.platforms) {
                if (checkCollision(gameState.player, platform)) {
                    // Alt çarpışma
                    if (gameState.player.velocityY > 0 && gameState.player.y < platform.y) {
                        gameState.player.y = platform.y - gameState.player.height;
                        gameState.player.velocityY = 0;
                        gameState.player.isJumping = false;
                        onGround = true;
                    }
                    // Üst çarpışma
                    else if (gameState.player.velocityY < 0 && gameState.player.y > platform.y) {
                        gameState.player.y = platform.y + platform.height;
                        gameState.player.velocityY = 0;
                    }
                    // Yan çarpışma
                    else if (gameState.player.velocityX !== 0) {
                        if (gameState.player.velocityX > 0) {
                            gameState.player.x = platform.x - gameState.player.width;
                        } else {
                            gameState.player.x = platform.x + platform.width;
                        }
                    }
                }
            }
            
            // Soru bloklarına çarpma
            for (const block of gameState.questionBlocks) {
                if (!block.used && checkCollision(gameState.player, block)) {
                    // Bloktan aşağıya zıplama - soruyu tetikle
                    if (gameState.player.velocityY > 0 && gameState.player.y < block.y) {
                        block.used = true;
                        showRandomQuestion();
                        gameState.player.velocityY = -gameState.player.jumpPower / 2;
                    }
                }
            }
            
            // Coin toplama
            for (const coin of gameState.coins) {
                if (!coin.collected && checkCollision(gameState.player, coin)) {
                    coin.collected = true;
                    gameState.score += 10;
                    updateUI();
                }
            }
            
            // Düşman çarpışması
            for (const enemy of gameState.enemies) {
                if (checkCollision(gameState.player, enemy)) {
                    // Düşmanın üstüne zıplama
                    if (gameState.player.velocityY > 0 && gameState.player.y < enemy.y) {
                        enemy.y = 1000; // Ekran dışına at
                        gameState.player.velocityY = -gameState.player.jumpPower / 1.5;
                        gameState.score += 20;
                        updateUI();
                    } else {
                        // Can kaybı
                        gameState.lives--;
                        updateUI();
                        if (gameState.lives <= 0) {
                            gameOver();
                        } else {
                            // Oyuncuyu başlangıç noktasına geri götür
                            gameState.player.x = 50;
                            gameState.player.y = 350;
                            gameState.player.velocityX = 0;
                            gameState.player.velocityY = 0;
                        }
                    }
                }
            }
            
            // Kamerayı güncelle
            gameState.camera.x = gameState.player.x - canvas.width / 2;
            
            // Seviye tamamlama kontrolü
            if (gameState.player.x > 1900 && gameState.questionsAnswered >= 3) {
                completeLevel();
            }
        }
        
        // Düşmanları güncelle
        function updateEnemies() {
            for (const enemy of gameState.enemies) {
                enemy.x += enemy.speed * enemy.direction;
                
                // Platform kenarlarında yön değiştir
                let onPlatform = false;
                for (const platform of gameState.platforms) {
                    if (enemy.x + enemy.width > platform.x && enemy.x < platform.x + platform.width &&
                        enemy.y + enemy.height >= platform.y && enemy.y < platform.y + platform.height) {
                        onPlatform = true;
                        break;
                    }
                }
                
                if (!onPlatform || enemy.x <= 0 || enemy.x + enemy.width >= 2000) {
                    enemy.direction *= -1;
                }
            }
        }
        
        // Çarpışma kontrolü
        function checkCollision(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width &&
                   obj1.x + obj1.width > obj2.x &&
                   obj1.y < obj2.y + obj2.height &&
                   obj1.y + obj1.height > obj2.y;
        }
        
        // Rastgele soru göster
        function showRandomQuestion() {
            const randomIndex = Math.floor(Math.random() * questions.length);
            gameState.currentQuestion = questions[randomIndex];
            
            // Soruyu hazırla
            questionText.textContent = `${gameState.currentQuestion.base}${getSuperscript(gameState.currentQuestion.exponent)} kaçtır?`;
            
            // Cevapları karıştır
            const answers = [gameState.currentQuestion.answer, ...gameState.currentQuestion.wrongAnswers];
            shuffleArray(answers);
            
            // Butonlara cevapları yerleştir
            answerOptions.forEach((option, index) => {
                option.textContent = answers[index];
                option.setAttribute('data-value', answers[index]);
            });
            
            // Soru penceresini göster
            questionPopup.style.display = 'block';
        }
        
        // Üs için üst simge formatı oluştur
        function getSuperscript(number) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹'];
            return number.toString().split('').map(digit => superscripts[digit]).join('');
        }
        
        // Diziyi karıştır
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Cevabı kontrol et
        function checkAnswer(selectedAnswer) {
            questionPopup.style.display = 'none';
            gameState.questionsAnswered++;
            
            if (selectedAnswer === gameState.currentQuestion.answer) {
                // Doğru cevap - bonus puan
                gameState.score += 50;
                gameState.questionsCorrect++;
                updateUI();
            } else {
                // Yanlış cevap - can kaybı
                gameState.lives--;
                updateUI();
                if (gameState.lives <= 0) {
                    gameOver();
                }
            }
            
            // Soru sayısını güncelle
            questionsCountElement.textContent = `Sorular: ${gameState.questionsAnswered}/3`;
        }
        
        // Seviyeyi tamamla
        function completeLevel() {
            gameState.isLevelComplete = true;
            levelScoreElement.textContent = gameState.score;
            correctQuestionsElement.textContent = gameState.questionsCorrect;
            levelCompleteScreen.style.display = 'block';
        }
        
        // Sonraki seviye
        function nextLevel() {
            gameState.level++;
            gameState.isLevelComplete = false;
            levelCompleteScreen.style.display = 'none';
            levelElement.textContent = `Seviye: ${gameState.level}`;
            createLevel();
        }
        
        // Oyun bitti
        function gameOver() {
            gameState.isGameOver = true;
            finalScoreElement.textContent = gameState.score;
            gameOverScreen.style.display = 'block';
        }
        
        // Oyunu yeniden başlat
        function restartGame() {
            gameState.score = 0;
            gameState.lives = 3;
            gameState.level = 1;
            gameState.isGameOver = false;
            gameState.isLevelComplete = false;
            gameState.questionsAnswered = 0;
            gameState.questionsCorrect = 0;
            gameOverScreen.style.display = 'none';
            levelCompleteScreen.style.display = 'none';
            levelElement.textContent = `Seviye: ${gameState.level}`;
            updateUI();
            createLevel();
        }
        
        // UI'ı güncelle
        function updateUI() {
            scoreElement.textContent = `Puan: ${gameState.score}`;
            livesElement.textContent = `Can: ${gameState.lives}`;
            questionsCountElement.textContent = `Sorular: ${gameState.questionsAnswered}/3`;
        }
        
        // Oyunu çiz
        function draw() {
            // Arkaplanı temizle
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Kamerayı uygula
            ctx.save();
            ctx.translate(-gameState.camera.x, -gameState.camera.y);
            
            // Platformları çiz
            ctx.fillStyle = '#8B4513';
            for (const platform of gameState.platforms) {
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                
                // Platform üstü çim
                ctx.fillStyle = '#7CFC00';
                ctx.fillRect(platform.x, platform.y, platform.width, 5);
                ctx.fillStyle = '#8B4513';
            }
            
            // Soru bloklarını çiz
            for (const block of gameState.questionBlocks) {
                if (!block.used) {
                    ctx.fillStyle = '#FFD700';
                    ctx.fillRect(block.x, block.y, block.width, block.height);
                    
                    // Soru işareti
                    ctx.fillStyle = '#000000';
                    ctx.font = '20px Arial';
                    ctx.fillText('?', block.x + 15, block.y + 25);
                } else {
                    // Kullanılmış blok
                    ctx.fillStyle = '#A9A9A9';
                    ctx.fillRect(block.x, block.y, block.width, block.height);
                }
            }
            
            // Coin'leri çiz
            for (const coin of gameState.coins) {
                if (!coin.collected) {
                    ctx.fillStyle = '#FFD700';
                    ctx.beginPath();
                    ctx.arc(coin.x + coin.width/2, coin.y + coin.height/2, coin.width/2, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = '#FFA500';
                    ctx.beginPath();
                    ctx.arc(coin.x + coin.width/2, coin.y + coin.height/2, coin.width/4, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // Düşmanları çiz
            for (const enemy of gameState.enemies) {
                if (enemy.y < 500) { // Ekran dışına atılan düşmanları çizme
                    ctx.fillStyle = '#FF0000';
                    ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                    
                    // Gözler
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(enemy.x + 5, enemy.y + 5, 5, 5);
                    ctx.fillRect(enemy.x + enemy.width - 10, enemy.y + 5, 5, 5);
                }
            }
            
            // Oyuncuyu çiz
            ctx.fillStyle = '#0000FF';
            ctx.fillRect(gameState.player.x, gameState.player.y, gameState.player.width, gameState.player.height);
            
            // Oyuncu yüzü
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(gameState.player.x + 20, gameState.player.y + 10, 5, 5);
            
            // Bitiş çizgisi
            ctx.fillStyle = '#00FF00';
            ctx.fillRect(1950, 400, 50, 50);
            ctx.fillStyle = '#FFFFFF';
            ctx.font = '20px Arial';
            ctx.fillText('BİTİŞ', 1950, 390);
            
            ctx.restore();
        }
        
        // Oyun döngüsü
        function gameLoop() {
            if (!gameState.isGameOver && !gameState.isLevelComplete) {
                updatePlayer();
                updateEnemies();
                draw();
            }
            requestAnimationFrame(gameLoop);
        }
        
        // Oyunu başlat
        initGame();
    </script>
</body>
</html>